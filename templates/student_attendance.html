<!DOCTYPE html>
<html>
<head>
    <title>Student Attendance</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student_attendance.css') }}">
</head>
<body>

<h2>Clock In / Clock Out</h2>
<p><strong>{{ user.name }}</strong></p>
<p>Current Time (SG): <span id="now">{{ now_time }}</span></p>

<table>
<thead>
<tr>
<th>Date</th><th>Shift</th><th>Clock In</th><th>Clock Out</th>
<th>Shift Start</th><th>Shift End</th><th>Hours</th><th>Remarks</th><th>Save</th>
</tr>
</thead>
<tbody>
{% for s in shifts %}
<tr>
  <td>{{ s.date }}</td>
  <td>{{ s.shiftperiod }} ({{ s.shiftlevel }})</td>

  <td>
    <button class="btn-clockin"
        data-key="{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}"
        data-action="clockin"
        onclick="clockAction('clockin', '{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')"
        {% if s.clockin not in [None,'','nan','NaT'] %} disabled {% endif %}>
      {% if s.clockin not in [None,'','nan','NaT'] %} {{ s.clockin }} {% else %} Clock In {% endif %}
    </button>
  </td>

  <td>
    <button class="btn-clockout"
        data-key="{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}"
        data-action="clockout"
        onclick="clockAction('clockout', '{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')"
        {% if s.clockout not in [None,'','nan','NaT'] or s.clockin in [None,'','nan','NaT'] %} disabled {% endif %}>
      {% if s.clockout not in [None,'','nan','NaT'] %} {{ s.clockout }} {% else %} Clock Out {% endif %}
    </button>
  </td>

  <td><input type="time" id="start_{{ loop.index }}" value="{{ s.shiftstart }}"></td>
  <td><input type="time" id="end_{{ loop.index }}" value="{{ s.shiftend }}"></td>
  <td>{{ s.shifthours or '-' }}</td>
  <td><input type="text" id="remarks_{{ loop.index }}" value="{{ s.remarks }}"></td>
  <td><button class="btn-save" onclick="saveAttendance('{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}', {{ loop.index }})">Save</button></td>
</tr>
{% endfor %}
</tbody>
</table>

<script src="{{ url_for('static', filename='js/student_attendance.js') }}"></script>
</body>
</html>
