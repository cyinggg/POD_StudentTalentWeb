<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Attendance</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student_attendance.css') }}">
</head>
<body>

<div class="header">
    <h2>Clock In / Clock Out</h2>
    <p class="user-name">Welcome, <strong>{{ user.name }}</strong></p>
    <p class="current-time">Current Time (SG): <span id="now">{{ now_time }}</span></p>
</div>

<div class="nav">
    <button class="btn-nav" onclick="history.back()">Back</button>
    <a class="btn-nav" href="{{ url_for('student_home') }}">Home</a>
</div>

<div class="table-container">
    <table>
        <thead>
        <tr>
            <th>Date</th>
            <th>Shift</th>
            <th>Clock In</th>
            <th>Clock Out</th>
            <th>Start</th>
            <th>End</th>
            <th>Hours</th>
            <th>Remarks</th>
            <th>Save</th>
        </tr>
        </thead>
        <tbody>
        {% for s in shifts %}
        <tr>
            <td>{{ s.date }}</td>
            <td>{{ s.shiftperiod }} ({{ s.shiftlevel }})</td>

            <!-- CLOCK IN -->
            <td>
                {% if s.clockin not in [None,'','nan','NaT'] %}
                    <span class="clock-time">{{ s.clockin }}</span>
                {% else %}
                    <button class="btn-clock btn-clockin"
                        id="clockin_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}"
                        onclick="clockAction('clockin','{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')">
                        Clock In
                    </button>
                {% endif %}
                <span id="clockin_time_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}" class="clock-time" style="display:none;"></span>
            </td>

            <!-- CLOCK OUT -->
            <td>
                {% if s.clockout not in [None,'','nan','NaT'] %}
                    <span class="clock-time">{{ s.clockout }}</span>
                {% else %}
                    <button class="btn-clock btn-clockout"
                        id="clockout_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}"
                        onclick="clockAction('clockout','{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')"
                        {% if s.clockin in [None,'','nan','NaT'] %} disabled {% endif %}>
                        Clock Out
                    </button>
                {% endif %}
                <span id="clockout_time_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}" class="clock-time" style="display:none;"></span>
            </td>

            <td><input type="time" id="start_{{ loop.index }}" value="{{ s.shiftstart }}" class="time-input"></td>
            <td><input type="time" id="end_{{ loop.index }}" value="{{ s.shiftend }}" class="time-input"></td>
            <td>{{ s.shifthours or "-" }}</td>
            <td><input type="text" id="remarks_{{ loop.index }}" value="{{ s.remarks }}" class="remarks-input"></td>

            <td>
                <button class="btn-save" onclick="saveAttendance('{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}', {{ loop.index }})">
                    Save
                </button>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<script src="{{ url_for('static', filename='js/student_attendance.js') }}"></script>

</body>
</html>
