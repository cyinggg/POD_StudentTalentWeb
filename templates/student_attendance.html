<!DOCTYPE html>
<html>
<head>
    <title>Student Attendance</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/student_attendance.css') }}">
</head>
<body>

<div class="nav">
    <button onclick="history.back()">Back</button>
    <a href="{{ url_for('student_home') }}">Home</a>
</div>

<h2>Clock In / Clock Out</h2>
<p><strong>{{ user.name }}</strong></p>
<p>Current Time (SG): <span id="now">{{ now_time }}</span></p>

<table class="attendance-table">
<thead>
<tr>
  <th>Date</th>
  <th>Shift</th>
  <th>Clock In</th>
  <th>Clock Out</th>
  <th>Shift Start</th>
  <th>Shift End</th>
  <th>Hours</th>
  <th>Remarks</th>
  <th>Save</th>
</tr>
</thead>

<tbody>
{% for s in shifts %}
<tr>
  <td>{{ s.date }}</td>
  <td>{{ s.shiftperiod }} ({{ s.shiftlevel }})</td>

  <!-- CLOCK IN -->
  <td>
    <span id="clockin_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}">
      {% if s.clockin not in [None, "", "nan", "NaT"] %}
        {{ s.clockin }}
      {% endif %}
    </span>
    {% if s.clockin in [None, "", "nan", "NaT"] %}
      <button class="btn-clockin"
              onclick="clockAction('clockin', '{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')">
        Clock In
      </button>
    {% endif %}
  </td>

  <!-- CLOCK OUT -->
  <td>
    <span id="clockout_{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}">
      {% if s.clockout not in [None, "", "nan", "NaT"] %}
        {{ s.clockout }}
      {% endif %}
    </span>
    {% if s.clockout in [None, "", "nan", "NaT"] %}
      <button class="btn-clockout"
              onclick="clockAction('clockout', '{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}')">
        Clock Out
      </button>
    {% endif %}
  </td>

  <!-- SHIFT START -->
  <td>
    <input type="time" id="start_{{ loop.index }}"
           value="{{ s.shiftstart }}">
  </td>

  <!-- SHIFT END -->
  <td>
    <input type="time" id="end_{{ loop.index }}"
           value="{{ s.shiftend }}">
  </td>

  <!-- HOURS -->
  <td>{{ s.shifthours or "-" }}</td>

  <!-- REMARKS -->
  <td>
    <input type="text" id="remarks_{{ loop.index }}"
           value="{{ s.remarks }}">
  </td>

  <!-- SAVE -->
  <td>
    <button class="btn-save"
      onclick="saveAttendance(
        '{{ user.id }}_{{ s.date }}_{{ s.shiftperiod }}_{{ s.shiftlevel }}',
        {{ loop.index }}
      )">
      Save
    </button>
  </td>
</tr>
{% endfor %}
</tbody>
</table>

<script src="{{ url_for('static', filename='js/student_attendance.js') }}"></script>
</body>
</html>
