{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-6">

  <h2 class="text-2xl font-bold mb-3">Slot Control â€“ POD / Administration</h2>
  <p class="mb-4">
    Select a month to manage slot availability.
    <br>
    <strong>All slots are closed by default</strong> unless explicitly opened.
  </p>

  <!-- Month Selector -->
  <form method="GET" class="flex items-center gap-3 mb-6">
    <label for="month" class="font-semibold">Select Month:</label>
    <input
      type="month"
      id="month"
      name="month"
      value="{{ selected_month }}"
      required
      class="border rounded px-2 py-1"
    >
    <button type="submit" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">
      Load
    </button>
  </form>

  {% if calendar_data %}
  <div class="overflow-x-auto">
    <table class="min-w-full border-collapse border border-gray-300">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="border p-2 text-left">Date</th>
          <th class="border p-2 text-left">Shift</th>
          <th class="border p-2 text-left">Level</th>
          <th class="border p-2 text-left">Slot #</th>
          <th class="border p-2 text-center">Status</th>
          <th class="border p-2 text-left">Remark</th>
          <th class="border p-2 text-center">Action</th>
        </tr>
      </thead>

      <tbody class="text-sm">
        {% for date, shifts in calendar_data.items() %}
          {% for shift_type, levels in shifts.items() %}
            {% for slot_level, slots in levels.items() %}
              {% for slot in slots %}
              <tr
                class="hover:bg-gray-50"
                data-month="{{ selected_month or '' }}"
                data-date="{{ date or '' }}"
                data-shift="{{ shift_type or '' }}"
                data-level="{{ slot_level or '' }}"
                data-slot="{{ slot.slot_number or 0 }}"
              >
                <td class="border p-2">{{ date }}</td>
                <td class="border p-2">{{ shift_type }}</td>
                <td class="border p-2 font-semibold">{{ slot_level }}</td>
                <td class="border p-2 text-center">Slot {{ slot.slot_number }}</td>

                <!-- Status -->
                <td class="border p-2 text-center">
                  {% if slot.is_open %}
                    <span class="text-green-700 font-bold">OPEN</span>
                  {% else %}
                    <span class="text-red-600 font-bold">CLOSED</span>
                  {% endif %}
                </td>

                <!-- Remark -->
                <td class="border p-2">
                  <input
                    type="text"
                    class="slot-remark border rounded w-full px-1 py-0.5"
                    placeholder="Optional remark"
                    value="{{ slot.remark or '' }}"
                  >
                </td>

                <!-- Action -->
                <td class="border p-2 text-center">
                  {% if slot.is_open %}
                    <button type="button" class="slot-toggle-btn bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" data-action="close">
                      Close
                    </button>
                  {% else %}
                    <button type="button" class="slot-toggle-btn bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600" data-action="open">
                      Open
                    </button>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            {% endfor %}
          {% endfor %}
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="italic text-gray-500">No data available for the selected month.</p>
  {% endif %}

</div>

<script src="{{ url_for('static', filename='admin.js') }}"></script>
{% endblock %}
