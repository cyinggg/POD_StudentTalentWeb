{% extends "base.html" %}

{% block title %}{{ role }} Calendar{% endblock %}

{% block content %}

<!-- ROLE FLAGS -->
<script>
    window.isCommittee = {{ "true" if role == "Student Talent Committee and Ambassador" else "false" }};
    window.isCoach = {{ "true" if role == "Student Coach" else "false" }};
    window.userRole = "{{ role }}";
    window.studentId = "{{ session['student_id'] }}";
</script>

<!-- CALENDAR -->
<div class="max-w-4xl mx-auto bg-white p-4 mt-6 rounded shadow">
    <h2 class="text-center text-2xl font-semibold mb-4">
        {{ month_name }} {{ year }}
    </h2>

    <table class="w-full table-fixed border-collapse">
        <thead>
        <tr class="bg-gray-200">
            <th class="p-2">Sun</th>
            <th class="p-2">Mon</th>
            <th class="p-2">Tue</th>
            <th class="p-2">Wed</th>
            <th class="p-2">Thu</th>
            <th class="p-2">Fri</th>
            <th class="p-2">Sat</th>
        </tr>
        </thead>
        <tbody>
        {% for week in cal %}
        <tr>
            {% for day in week %}
            {% if day == 0 %}
                <td class="border p-4 bg-gray-50"></td>
            {% else %}
                {% set date_str = year ~ '-' ~ '%02d'|format(month) ~ '-' ~ '%02d'|format(day) %}
                <td class="calendar-day border p-4 hover:bg-blue-50 cursor-pointer"
                    data-date="{{ date_str }}">
                    <div class="font-semibold">{{ day }}</div>
                    <div class="day-marker text-xs mt-1"></div>
                </td>
            {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- ============================= -->
<!-- COMMITTEE MODAL -->
<!-- ============================= -->
<div id="committeeModal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-96 p-6 rounded shadow">
        <h2 class="text-lg font-bold mb-2">Submit Entry</h2>
        <p id="committeeSelectedDate" class="font-semibold mb-3"></p>

        <label class="block font-semibold">Type</label>
        <select id="committeeType" class="w-full border p-2 mb-3">
            <option value="Availability">Availability</option>
            <option value="Event">Event</option>
        </select>

        <label class="block font-semibold">Details</label>
        <textarea id="committeeDetails" class="w-full border p-2 mb-4" rows="3"></textarea>

        <div class="flex justify-between">
            <button onclick="closeCommitteeModal()" class="px-4 py-2 bg-gray-400 text-white rounded">Cancel</button>
            <button onclick="submitCommitteeEntry()" class="px-4 py-2 bg-blue-600 text-white rounded">Submit</button>
        </div>
    </div>
</div>

<!-- ============================= -->
<!-- STUDENT COACH MODAL -->
<!-- ============================= -->
<div id="coachModal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-[500px] p-6 rounded shadow max-h-[80vh] overflow-y-auto">
        <h2 class="text-lg font-bold mb-2">Apply for Shift</h2>
        <p id="coachSelectedDate" class="font-semibold mb-4"></p>

        <!-- Slots auto-generated by JS -->
        <div id="shiftContainer" class="space-y-3">
            <!-- buildShiftSlots() will generate collapsible shifts and buttons here -->
        </div>

        <div class="mt-4 text-right">
            <button onclick="closeCoachModal()" class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Close</button>
        </div>
    </div>
</div>

{% endblock %}
