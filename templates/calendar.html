{% extends "base.html" %}

{% block title %}{{ role }} Calendar{% endblock %}

{% block content %}

<!-- ROLE FLAGS -->
<script>
    window.isCommittee = {{ "true" if role == "Student Talent Committee and Ambassador" else "false" }};
    window.isCoach = {{ "true" if role == "Student Coach" else "false" }};
    window.userRole = "{{ role }}";
    window.studentId = "{{ session['student_id'] }}";
</script>

<script>
    window.selectedMonth = "{{ year }}-{{ '%02d'|format(month) }}";
</script>

<!-- CALENDAR -->
<div class="max-w-4xl mx-auto bg-white p-4 mt-6 rounded shadow">

    <!-- Month Navigation -->
    <div class="flex justify-between items-center mb-4">
        {% set prev_month = month - 1 if month > 1 else 12 %}
        {% set prev_year = year if month > 1 else year - 1 %}
        {% set next_month = month + 1 if month < 12 else 1 %}
        {% set next_year = year if month < 12 else year + 1 %}

        <button onclick="window.location.href='{{ url_for('calendar_view') }}?month={{ prev_month }}&year={{ prev_year }}'"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">← Prev</button>

        <h2 class="text-center text-2xl font-semibold">{{ month_name }} {{ year }}</h2>

        <button onclick="window.location.href='{{ url_for('calendar_view') }}?month={{ next_month }}&year={{ next_year }}'"
                class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Next →</button>
    </div>

    <table class="w-full table-fixed border-collapse">
        <thead>
        <tr class="bg-gray-200">
            <th class="p-2">Mon</th>
            <th class="p-2">Tue</th>
            <th class="p-2">Wed</th>
            <th class="p-2">Thu</th>
            <th class="p-2">Fri</th>
            <th class="p-2">Sat</th>
            <th class="p-2">Sun</th>
        </tr>
        </thead>
        <tbody>
        {% for week in cal %}
        <tr>
            {% for day in week %}
            {% if day == 0 %}
                <td class="border p-4 bg-gray-50"></td>
            {% else %}
                {% set date_str = year ~ '-' ~ '%02d'|format(month) ~ '-' ~ '%02d'|format(day) %}
                <td class="calendar-day border p-4 hover:bg-blue-50 cursor-pointer"
                    data-date="{{ date_str }}">
                    <div class="font-semibold">{{ day }}</div>
                    <div class="day-marker text-xs mt-1"></div>
                </td>
            {% endif %}
            {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- ============================= -->
<!-- STUDENT COACH MODAL -->
<!-- ============================= -->
<div id="coachModal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white w-[500px] p-6 rounded shadow max-h-[80vh] overflow-y-auto">
        <h2 class="text-lg font-bold mb-2">Apply for Shift</h2>
        <p id="coachSelectedDate" class="font-semibold mb-4"></p>

        <!-- Slots auto-generated by JS -->
        <div id="shiftContainer" class="space-y-3">
            <!-- buildShiftSlots() will generate collapsible shifts and buttons here -->
        </div>

        <div class="mt-4 text-right">
            <button onclick="closeCoachModal()" class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Close</button>
        </div>
    </div>
</div>

{% endblock %}
