<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ProjectHub Duty Calendar</title>

<link href="{{ url_for('static', filename='css/projecthub_duty_calendar.css') }}" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<div class="container my-4">
    <h2 class="mb-4">ProjectHub Duty Calendar</h2>

    <div class="mb-3 d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm"
                onclick="window.history.back()">Back</button>
        <a href="{{ url_for('home') }}"
        class="btn btn-outline-primary btn-sm">Home</a>
    </div>

    <!-- Month Navigation -->
    <div class="mb-3">
        <a href="{{ url_for('projecthub_duty_calendar',
                            month=month-1 if month>1 else 12,
                            year=year-1 if month==1 else year) }}"
           class="btn btn-sm btn-outline-primary">
            &laquo; Previous Month
        </a>

        <span class="mx-2">{{ year }} - {{ "%02d"|format(month) }}</span>

        <a href="{{ url_for('projecthub_duty_calendar',
                            month=month+1 if month<12 else 1,
                            year=year+1 if month==12 else year) }}"
           class="btn btn-sm btn-outline-primary">
            Next Month &raquo;
        </a>
    </div>

    <!-- Calendar -->
    <div id="calendarContainer">
        <div class="calendar" id="calendarGrid">

            <!-- Weekday headers (Monday first) -->
            {% for wd in ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'] %}
                <div class="day header">{{ wd }}</div>
            {% endfor %}

            <!-- Calendar days -->
            {% for week in month_days %}
                {% for day in week %}

                    {% if day.month == month %}
                        {% set date_str = day.strftime('%Y-%m-%d') %}
                        {% set apps = shifts_per_date.get(date_str, []) %}

                        <div class="day"
                             data-date="{{ date_str }}"
                             {% if day == today %}data-today="true"{% endif %}>

                            <div class="date-number">{{ day.day }}</div>

                            {% set morning = apps | selectattr('shiftperiod', 'equalto', 'morning') | list %}
                            {% set afternoon = apps | selectattr('shiftperiod', 'equalto', 'afternoon') | list %}
                            {% set night = apps | selectattr('shiftperiod', 'equalto', 'night') | list %}

                            <div class="shift-section morning">
                                <div class="shift-title">Morning</div>

                                {% if morning %}
                                    {% for app in morning %}
                                        <div class="shift-name">{{ app['name'] }}</div>
                                    {% endfor %}
                                {% else %}
                                    <div class="shift-empty">No Student Coach</div>
                                {% endif %}
                            </div>

                            <div class="shift-section afternoon">
                                <div class="shift-title">Afternoon</div>

                                {% if afternoon %}
                                    {% for app in afternoon %}
                                        <div class="shift-name">{{ app['name'] }}</div>
                                    {% endfor %}
                                {% else %}
                                    <div class="shift-empty">No Student Coach</div>
                                {% endif %}
                            </div>

                            <div class="shift-section night">
                                <div class="shift-title">Night</div>

                                {% if night %}
                                    {% for app in night %}
                                        <div class="shift-name">{{ app['name'] }}</div>
                                    {% endfor %}
                                {% else %}
                                    <div class="shift-empty">No Student Coach</div>
                                {% endif %}
                            </div>

                        </div>
                    {% else %}
                        <div class="day empty"></div>
                    {% endif %}

                {% endfor %}
            {% endfor %}

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
